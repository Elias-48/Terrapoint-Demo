<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Moderador | Terrapoint</title>
  <link rel="icon" type="image/png" href="../img/icon.png" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous" />
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
  <link rel="stylesheet" href="../css/style.css" />
  <link rel="stylesheet" href="../css/estilos.css" />
</head>
<body>
  <!-- NAVBAR -->
  <nav class="navbar navbar-expand-lg navbar-dark moderador-theme">
    <div class="container-xxl">
        <a class="navbar-brand d-flex align-items-center gap-2 text-white" href="index.html">
          <img src="../img/logo.png" alt="Logo Terrapoint" width="100" height="80" />
          <span class="fw-bold text-white">TERRAPOINT</span>
        </a>
      <!-- Botón hamburguesa -->
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#modNavbar" aria-controls="modNavbar" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>

      <!-- Menú colapsable -->
      <div class="collapse navbar-collapse" id="modNavbar">
        <div class="navbar-nav ms-auto align-items-lg-center gap-2">
          <span class="nav-link text-white fw-semibold d-none d-lg-inline" data-i18n="mod.nav.greeting">Hola, Moderador</span>
          <a class="nav-link text-white" href="index.html" data-i18n="mod.nav.logout">Salir</a>
          <a href="chat-moderador.html" class="nav-link fw-bold text-dark ms-2" id="goToChatBtn" data-i18n="mod.nav.chat">Chat</a>
          <!-- Language dropdown with flags -->
          <div class="ms-lg-3">
            <div class="dropdown">
              <button id="lang-dropdown-toggle" class="btn btn-light btn-sm d-flex align-items-center dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                <img id="lang-dropdown-flag" src="../img/BanderaEN.svg.png" alt="EN" width="18" height="12" class="me-2" />
                <span id="lang-dropdown-label">EN</span>
              </button>
              <ul class="dropdown-menu dropdown-menu-end">
                <li>
                  <a href="#" class="dropdown-item d-flex align-items-center lang-item" data-lang="en">
                    <img src="../img/BanderaEN.svg.png" alt="EN" width="18" height="12" class="me-2" />
                    <span>EN</span>
                  </a>
                </li>
                <li>
                  <a href="#" class="dropdown-item d-flex align-items-center lang-item" data-lang="es">
                    <img src="../img/BanderaES.svg.png" alt="ES" width="18" height="12" class="me-2" />
                    <span>ES</span>
                  </a>
                </li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </div>
  </nav>

  <!-- Saludo destacado en móvil, fuera del encabezado -->
  <div class="container d-block d-lg-none py-2 text-center">
    <span class="fw-semibold fs-4" data-i18n="mod.nav.greeting">Hola, Moderador</span>
  </div>

  <main class="py-4">
    <div class="container">
      <div class="row g-3">
        <!-- Lista de reportes -->
        <div class="col-12">
          <div class="card">
            <div class="card-body p-3">
              <div class="d-flex justify-content-between align-items-center mb-3">
                <h5 class="card-title mb-0" data-i18n="mod.reports.title">Reportes recibidos</h5>
                <button id="addTestReport" class="btn btn-primary btn-sm" data-i18n="mod.reports.addTest">Agregar Reporte de Prueba</button>
              </div>
              <div class="d-flex flex-nowrap overflow-auto pb-3" style="gap: 15px; padding: 5px 0;">

              <!-- Reporte 1 -->
              <div style="width: 250px; flex-shrink: 0;">
                <div class="card h-100" data-report-id="r1" style="font-size: 0.7rem;">
                  <img src="../img/1.png" class="card-img-top" alt="Evidencia" style="border-bottom: 1px solid rgba(0,0,0,.125);">
                  <div class="card-body p-1">
                    <h6 class="card-title mb-2" style="font-size: 0.9rem; min-height: 2em; line-height: 1.2; overflow: hidden; text-overflow: ellipsis; display: -webkit-box; -webkit-line-clamp: 2; line-clamp: 2; -webkit-box-orient: vertical;" data-i18n="mod.reports.r1.title">Derrame de residuos</h6>
                    <p class="small text-muted mb-2 mt-2" style="font-size: 0.8rem; line-height: 1.3; min-height: 2em; overflow: hidden; text-overflow: ellipsis; display: -webkit-box; -webkit-line-clamp: 2; line-clamp: 2; -webkit-box-orient: vertical;" data-i18n="mod.reports.addr">Av. Central 123</p>
                    <p class="small text-muted mb-1" style="font-size: 0.6rem;"><small class="text-muted"><span data-i18n="mod.reports.by">Por:</span> <span id="r1Reporter">E. Rivera</span></small></p>
                    <div class="d-flex flex-wrap g-0" style="gap: 4px; margin-top: 0.5rem;">
                      <a href="#" class="btn btn-gradient btn-sm flex-grow-1" style="font-size: 0.8rem; padding: 0.25rem 0.4rem; min-width: 0;" data-i18n="mod.reports.accept">Acep.</a>
                      <a href="#" class="btn btn-orange btn-sm flex-grow-1" style="font-size: 0.8rem; padding: 0.25rem 0.4rem; min-width: 0;" data-i18n="mod.reports.reject">Rech.</a>
                      <button type="button" class="btn btn-outline-secondary btn-sm flex-grow-1" style="font-size: 0.8rem; padding: 0.25rem 0.4rem; min-width: 0;" data-report-id="r1" data-chat-name="Derrame de residuos" data-chat-info="Av. Central 123" data-reporter="E. Rivera">
                        <span data-i18n="mod.reports.chat" style="font-size: 0.6rem;">Chat</span>
                      </button>
                    </div>
                    </div>
                  </div>
                </div>
              </div>
              </div>

              

            </div>
          </div>
        </div>

        
      </div>

      <!-- PANEL ADMIN CRUD -->
      <section class="mt-5 admin-panel">
        <div class="card">
          <div class="card-body p-4">
            <h4 class="mb-3" data-i18n="mod.admin.title">Panel de administración</h4>

            <ul class="nav nav-tabs" id="crudTabs" role="tablist">
              <li class="nav-item" role="presentation">
                <button class="nav-link" id="tab-users" data-bs-toggle="tab" data-bs-target="#pane-users" type="button" role="tab" data-i18n="mod.admin.tabs.reports">Reportes</button>
              </li>
              <li class="nav-item" role="presentation">
                <button class="nav-link active" id="tab-news" data-bs-toggle="tab" data-bs-target="#pane-news" type="button" role="tab" data-i18n="mod.admin.tabs.news">Novedades</button>
              </li>
              <li class="nav-item" role="presentation">
                <button class="nav-link" id="tab-comments" data-bs-toggle="tab" data-bs-target="#pane-comments" type="button" role="tab" data-i18n="mod.admin.tabs.comments">Comentarios</button>
              </li>
              <li class="nav-item" role="presentation">
                <button class="nav-link" id="tab-resources" data-bs-toggle="tab" data-bs-target="#pane-resources" type="button" role="tab" data-i18n="mod.admin.tabs.resources">Recursos</button>
              </li>
              <li class="nav-item" role="presentation">
                <button class="nav-link" id="tab-gam" data-bs-toggle="tab" data-bs-target="#pane-gam" type="button" role="tab" data-i18n="mod.admin.tabs.gam">Gamificación</button>
              </li>
              <li class="nav-item" role="presentation">
                <button class="nav-link" id="tab-indices" data-bs-toggle="tab" data-bs-target="#pane-indices" type="button" role="tab" data-i18n="mod.admin.tabs.indices">Índices</button>
              </li>
              <li class="nav-item" role="presentation">
                <button class="nav-link" id="tab-usuarios" data-bs-toggle="tab" data-bs-target="#pane-usuarios" type="button" role="tab" data-i18n="mod.admin.tabs.users">Usuarios</button>
              </li>
            </ul>

            <div class="tab-content mt-4">
              <!-- NOVEDADES -->
              <div class="tab-pane fade show active" id="pane-news" role="tabpanel">
                <form id="formNews" class="row g-3">
                  <div class="col-md-5">
                    <label class="form-label" for="newsTitle" data-i18n="mod.news.title.label">Título</label>
                    <input id="newsTitle" type="text" class="form-control" placeholder="Título de la novedad" data-i18n="mod.news.title.placeholder">
                  </div>
                  <div class="col-md-4">
                    <label class="form-label" for="newsImgFile" data-i18n="mod.common.image">Imagen</label>
                    <input id="newsImgFile" type="file" class="form-control d-none" accept="image/jpeg,image/png,image/gif,image/webp,.jpg,.jpeg,.png,.gif,.webp">
                    <div class="d-flex align-items-center gap-2">
                      <button id="newsImgBtn" type="button" class="btn btn-outline-secondary btn-sm" data-i18n="mod.file.select_button">Select file</button>
                      <small id="newsImgStatus" class="text-muted" data-i18n="mod.file.no_file">No file selected</small>
                      <span id="newsImgTpl" hidden data-i18n="mod.file.selected">Selected: {name}</span>
                    </div>
                    <div class="form-text" data-i18n="mod.common.image.help">Formatos: JPG, JPEG, PNG, GIF, WEBP. Máx. 5 MB.</div>
                  </div>
                  <div class="col-12">
                    <label class="form-label" for="newsText" data-i18n="mod.news.content.label">Contenido</label>
                    <textarea id="newsText" class="form-control" rows="3" placeholder="Descripción" data-i18n="mod.news.content.placeholder"></textarea>
                  </div>
                  <div class="col-12 d-flex gap-2">
                    <button type="submit" class="btn btn-gradient" data-i18n="mod.common.save">Guardar</button>
                    <button type="button" id="newsReset" class="btn btn-outline-secondary" data-i18n="mod.common.reset">Limpiar</button>
                  </div>
                </form>
                <div id="newsAlert" class="alert alert-warning d-none mt-2" role="alert"></div>
                <hr/>
                <div id="newsList" class="h-scroll-cards"></div>
                <div class="table-responsive mt-3">
                  <h6 class="mb-2" data-i18n="mod.news.published">Publicados en Novedades</h6>
                  <table class="table table-sm align-middle">
                    <thead class="table-light">
                      <tr>
                        <th style="width:20%" data-i18n="mod.table.title">Título</th>
                        <th style="width:25%" data-i18n="mod.table.image">Imagen</th>
                        <th data-i18n="mod.table.content">Contenido</th>
                        <th style="width:140px" data-i18n="mod.table.actions">Acciones</th>
                      </tr>
                    </thead>
                    <tbody id="newsTableBody"></tbody>
                  </table>
                </div>
              </div>
              
              <!-- REPORTES ACEPTADOS (en pestaña Reportes) -->
              <div class="tab-pane fade" id="pane-users" role="tabpanel">
                <div class="table-responsive">
                  <h6 class="mb-2" data-i18n="mod.accepted.title">Reportes aceptados</h6>
                  <table class="table table-sm align-middle">
                    <thead class="table-light">
                      <tr>
                        <th style="width:28%" data-i18n="mod.table.title">Título</th>
                        <th style="width:28%" data-i18n="mod.table.address">Dirección</th>
                        <th style="width:16%" data-i18n="mod.table.date">Fecha</th>
                        <th style="width:12%" data-i18n="mod.table.status">Estado</th>
                        <th style="width:16%" data-i18n="mod.table.actions">Acciones</th>
                      </tr>
                    </thead>
                    <tbody id="acceptedReportsTable"></tbody>
                  </table>
                  <div id="acceptedEmpty" class="text-muted small d-none" data-i18n="mod.accepted.empty">No hay reportes aceptados.</div>
                </div>
              </div>

              <!-- USUARIOS (contenido original restaurado) -->
              <div class="tab-pane fade" id="pane-usuarios" role="tabpanel">
                <!-- Resumen -->
                <div class="row g-3 mb-3">
                  <div class="col-sm-6 col-lg-3">
                    <div class="card h-100 shadow-sm">
                      <div class="card-body">
                        <div class="small text-muted" data-i18n="mod.users.summary.total">Total usuarios</div>
                        <div class="h4 mb-0" id="usersTotal">2</div>
                      </div>
                    </div>
                  </div>
                  <div class="col-sm-6 col-lg-3">
                    <div class="card h-100 shadow-sm">
                      <div class="card-body">
                        <div class="small text-muted" data-i18n="mod.users.summary.common_level">Nivel más común</div>
                        <div class="h6 mb-0"><span data-i18n="mod.level.2">Nivel 2 · Colaborador</span></div>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- Filtros y búsqueda -->
                <div class="d-flex flex-wrap gap-2 justify-content-between align-items-center mb-3">
                  <div class="input-group" style="max-width: 360px;">
                    <span class="input-group-text" data-i18n="mod.users.search.label">Buscar</span>
                    <input id="usersSearch" type="search" class="form-control" placeholder="Nombre, nivel o puntos" data-i18n="mod.users.search.placeholder" />
                  </div>
                </div>

                <!-- Tabla usuarios -->
                <div class="table-responsive">
                  <table class="table table-sm align-middle">
                    <thead class="table-light">
                      <tr>
                        <th style="width:34%" data-i18n="mod.users.table.user">Usuario</th>
                        <th style="width:22%" class="text-center" data-i18n="mod.users.table.level">Nivel</th>
                        <th class="text-end" data-i18n="mod.table.actions">Acciones</th>
                      </tr>
                    </thead>
                    <tbody id="usersTableBody"></tbody>
                  </table>
                </div>
                <div id="usersEmpty" class="text-muted small d-none" data-i18n="mod.users.empty">Sin usuarios cargados.</div>

                <!-- Paginación simulada -->
                <nav class="mt-3" aria-label="Usuarios">
                  <ul class="pagination pagination-sm mb-0">
                    <li class="page-item disabled"><span class="page-link" data-i18n="mod.pagination.prev">Anterior</span></li>
                    <li class="page-item active"><span class="page-link">1</span></li>
                    <li class="page-item disabled"><span class="page-link" data-i18n="mod.pagination.next">Siguiente</span></li>
                  </ul>
                </nav>
              </div>

              <!-- COMENTARIOS -->
              <div class="tab-pane fade" id="pane-comments" role="tabpanel">
                <form id="formComments" class="row g-3">
                  <div class="col-md-4">
                    <label class="form-label" for="cAuthor" data-i18n="mod.comments.author.label">Autor</label>
                    <input id="cAuthor" type="text" class="form-control" placeholder="Nombre del autor" data-i18n="mod.comments.author.placeholder">
                  </div>
                  <div class="col-12">
                    <label class="form-label" for="cText" data-i18n="mod.comments.text.label">Comentario</label>
                    <textarea id="cText" class="form-control" rows="3" placeholder="Escribe el comentario" data-i18n="mod.comments.text.placeholder"></textarea>
                  </div>
                  <div class="col-12 d-flex gap-2">
                    <button type="submit" class="btn btn-gradient" data-i18n="mod.common.save">Guardar</button>
                    <button type="button" id="cReset" class="btn btn-outline-secondary" data-i18n="mod.common.reset">Limpiar</button>
                  </div>
                </form>
                <div id="commentsAlert" class="alert alert-warning d-none mt-2" role="alert"></div>
                <hr/>
                <div id="commentsList" class="row g-3"></div>
                <div class="table-responsive mt-3">
                  <h6 class="mb-2" data-i18n="mod.comments.published">Publicados en Comentarios</h6>
                  <table class="table table-sm align-middle">
                    <thead class="table-light">
                      <tr>
                        <th style="width:20%" data-i18n="mod.comments.table.author">Autor</th>
                        <th data-i18n="mod.comments.table.text">Comentario</th>
                        <th style="width:140px" data-i18n="mod.table.actions">Acciones</th>
                      </tr>
                    </thead>
                    <tbody id="commentsTableBody"></tbody>
                  </table>
                </div>
              </div>

              <!-- RECURSOS -->
              <div class="tab-pane fade" id="pane-resources" role="tabpanel">
                <form id="formResources" class="row g-3">
                  <div class="col-md-5">
                    <label class="form-label" for="rTitle" data-i18n="mod.res.title.label">Título</label>
                    <input id="rTitle" type="text" class="form-control" placeholder="Título del recurso" data-i18n="mod.res.title.placeholder">
                  </div>
                  <div class="col-md-4">
                    <label class="form-label" for="rImgFile" data-i18n="mod.common.image">Imagen</label>
                    <input id="rImgFile" type="file" class="form-control d-none" accept="image/jpeg,image/png,image/gif,image/webp,.jpg,.jpeg,.png,.gif,.webp">
                    <div class="d-flex align-items-center gap-2">
                      <button id="rImgBtn" type="button" class="btn btn-outline-secondary btn-sm" data-i18n="mod.file.select_button">Select file</button>
                      <small id="rImgStatus" class="text-muted" data-i18n="mod.file.no_file">No file selected</small>
                      <span id="rImgTpl" hidden data-i18n="mod.file.selected">Selected: {name}</span>
                    </div>
                    <div class="form-text" data-i18n="mod.common.image.help">Formatos: JPG, JPEG, PNG, GIF, WEBP. Máx. 5 MB.</div>
                  </div>
                  <div class="col-12">
                    <label class="form-label" for="rText" data-i18n="mod.res.desc.label">Descripción</label>
                    <textarea id="rText" class="form-control" rows="3" placeholder="Descripción" data-i18n="mod.res.desc.placeholder"></textarea>
                  </div>
                  <div class="col-12 d-flex gap-2">
                    <button type="submit" class="btn btn-gradient" data-i18n="mod.common.save">Guardar</button>
                    <button type="button" id="rReset" class="btn btn-outline-secondary" data-i18n="mod.common.reset">Limpiar</button>
                  </div>
                </form>
                <div id="resourcesAlert" class="alert alert-warning d-none mt-2" role="alert"></div>
                <hr/>
                <div id="resourcesList" class="h-scroll-cards"></div>
                <div class="table-responsive mt-3">
                  <h6 class="mb-2" data-i18n="mod.res.published">Publicados en Recursos</h6>
                  <table class="table table-sm align-middle">
                    <thead class="table-light">
                      <tr>
                        <th style="width:20%" data-i18n="mod.table.title">Título</th>
                        <th style="width:25%" data-i18n="mod.table.image">Imagen</th>
                        <th data-i18n="mod.res.table.desc">Descripción</th>
                        <th style="width:140px" data-i18n="mod.table.actions">Acciones</th>
                      </tr>
                    </thead>
                    <tbody id="resourcesTableBody"></tbody>
                  </table>
                </div>
              </div>

              <!-- GAMIFICACIÓN -->
              <div class="tab-pane fade" id="pane-gam" role="tabpanel">
                <form id="formGam" class="row g-3">
                  <div class="col-md-5">
                    <label class="form-label" for="gTitle" data-i18n="mod.gam.title.label">Título</label>
                    <input id="gTitle" type="text" class="form-control" placeholder="Título de la tarjeta" data-i18n="mod.gam.title.placeholder">
                  </div>
                  <div class="col-md-4">
                    <label class="form-label" for="gImgFile" data-i18n="mod.common.image">Imagen</label>
                    <input id="gImgFile" type="file" class="form-control d-none" accept="image/jpeg,image/png,image/gif,image/webp,.jpg,.jpeg,.png,.gif,.webp">
                    <div class="d-flex align-items-center gap-2">
                      <button id="gImgBtn" type="button" class="btn btn-outline-secondary btn-sm" data-i18n="mod.file.select_button">Select file</button>
                      <small id="gImgStatus" class="text-muted" data-i18n="mod.file.no_file">No file selected</small>
                      <span id="gImgTpl" hidden data-i18n="mod.file.selected">Selected: {name}</span>
                    </div>
                    <div class="form-text" data-i18n="mod.common.image.help">Formatos: JPG, JPEG, PNG, GIF, WEBP. Máx. 5 MB.</div>
                  </div>
                  <div class="col-12">
                    <label class="form-label" for="gText" data-i18n="mod.gam.desc.label">Descripción</label>
                    <textarea id="gText" class="form-control" rows="3" placeholder="Descripción" data-i18n="mod.gam.desc.placeholder"></textarea>
                  </div>
                  <div class="col-12 d-flex gap-2">
                    <button type="submit" class="btn btn-gradient" data-i18n="mod.common.save">Guardar</button>
                    <button type="button" id="gReset" class="btn btn-outline-secondary" data-i18n="mod.common.reset">Limpiar</button>
                  </div>
                </form>
                <div id="gamAlert" class="alert alert-warning d-none mt-2" role="alert"></div>
                <hr/>
                <div id="gamList" class="h-scroll-cards"></div>
                <div class="table-responsive mt-3">
                  <h6 class="mb-2" data-i18n="mod.gam.published">Publicados en Gamificación</h6>
                  <table class="table table-sm align-middle">
                    <thead class="table-light">
                      <tr>
                        <th style="width:20%">Título</th>
                        <th style="width:25%">Imagen</th>
                        <th>Descripción</th>
                        <th style="width:140px">Acciones</th>
                      </tr>
                    </thead>
                    <tbody id="gamTableBody"></tbody>
                  </table>
                </div>
              </div>

              <!-- ÍNDICES (tarjetas) -->
              <div class="tab-pane fade" id="pane-indices" role="tabpanel">
                <form id="formIdx" class="row g-3">
                  <div class="col-md-3">
                    <label class="form-label" for="idxAir" data-i18n="mod.idx.air.label">Calidad del aire (%)</label>
                    <input id="idxAir" type="number" min="0" max="100" class="form-control" placeholder="75">
                  </div>
                  <div class="col-md-3">
                    <label class="form-label" for="idxPoll" data-i18n="mod.idx.poll.label">Contaminación (%)</label>
                    <input id="idxPoll" type="number" min="0" max="100" class="form-control" placeholder="40">
                  </div>
                  <div class="col-md-3">
                    <label class="form-label" for="idxGreen" data-i18n="mod.idx.green.label">Zonas verdes (%)</label>
                    <input id="idxGreen" type="number" min="0" max="100" class="form-control" placeholder="60">
                  </div>
                  <div class="col-md-3">
                    <label class="form-label" for="idxTemp" data-i18n="mod.idx.temp.label">Temp. global (%)</label>
                    <input id="idxTemp" type="number" min="0" max="100" class="form-control" placeholder="55">
                  </div>
                  <div class="col-12 d-flex gap-2">
                    <button type="submit" class="btn btn-gradient" data-i18n="mod.idx.save">Guardar índices</button>
                    <button type="button" id="idxReset" class="btn btn-outline-secondary" data-i18n="mod.common.restore">Restablecer</button>
                  </div>
                </form>
                <hr/>
                <div class="table-responsive mt-3">
                  <h6 class="mb-2" data-i18n="mod.idx.published">Índices publicados</h6>
                  <table class="table table-sm align-middle">
                    <thead class="table-light">
                      <tr>
                        <th data-i18n="mod.idx.col.air">Calidad del aire</th>
                        <th data-i18n="mod.idx.col.poll">Contaminación</th>
                        <th data-i18n="mod.idx.col.green">Zonas verdes</th>
                        <th data-i18n="mod.idx.col.temp">Temp. global</th>
                        <th style="width:200px" data-i18n="mod.table.actions">Acciones</th>
                      </tr>
                    </thead>
                    <tbody id="indicesTableBody"></tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>
    </div>
  </main>
  
  

  <script src="../javaScript/moderador.js"></script>
  <script src="../js-Idioma/ModeradorIdioma.js"></script>
  <script src="../javaScript/fileInputEnhancer.js"></script>
  <script>
    (function(){
      function wireFileControl(inputId, btnId, statusId, tplId){
        const input = document.getElementById(inputId);
        const btn = document.getElementById(btnId);
        const status = document.getElementById(statusId);
        const tplEl = document.getElementById(tplId);
        if (!input || !btn || !status || !tplEl) return;
        btn.addEventListener('click', function(){ input.click(); });
        input.addEventListener('change', function(){
          const files = input.files;
          if (!files || files.length === 0){
            status.setAttribute('data-i18n','mod.file.no_file');
            const fallback = (document.documentElement.lang === 'es') ? 'Ningún archivo seleccionado' : 'No file selected';
            status.textContent = fallback;
          } else {
            const tpl = tplEl.textContent || 'Selected: {name}';
            const name = files.length === 1 ? files[0].name : files.length + ' files';
            status.textContent = tpl.replace('{name}', name);
            status.removeAttribute('data-i18n');
          }
        });
      }
      function init(){
        wireFileControl('newsImgFile','newsImgBtn','newsImgStatus','newsImgTpl');
        wireFileControl('rImgFile','rImgBtn','rImgStatus','rImgTpl');
        wireFileControl('gImgFile','gImgBtn','gImgStatus','gImgTpl');
      }
      if (document.readyState === 'loading') document.addEventListener('DOMContentLoaded', init); else init();
    })();
  </script>
  
  <script>
    (function(){
      function syncChatSidebar(){
        var sidebar = document.getElementById('chatSidebar');
        if (!sidebar) return;
        var nav = document.querySelector('nav.navbar');
        var top = 0;
        if (nav && nav.getBoundingClientRect) {
          var rect = nav.getBoundingClientRect();
          var vb = rect.bottom; // px from viewport top to bottom of navbar
          if (vb > 0) top = vb; else top = 0;
        }
        sidebar.style.top = top + 'px';
        sidebar.style.height = 'calc(100vh - ' + top + 'px)';
      }
      // Initial and listeners
      window.addEventListener('load', syncChatSidebar);
      window.addEventListener('resize', syncChatSidebar);
      window.addEventListener('scroll', syncChatSidebar, { passive: true });
      // Observe navbar size changes (e.g., i18n reflow)
      try {
        var nav = document.querySelector('nav.navbar');
        if (nav && window.ResizeObserver) {
          var ro = new ResizeObserver(syncChatSidebar);
          ro.observe(nav);
        }
      } catch (e) {}
      document.addEventListener('DOMContentLoaded', syncChatSidebar);
      // Also re-sync shortly after potential layout changes
      setTimeout(syncChatSidebar, 100);
      setTimeout(syncChatSidebar, 300);
    })();
  </script>
  
  <script>
    // Script para manejar el botón de agregar reporte de prueba
    document.addEventListener('DOMContentLoaded', function() {
      const addTestReportBtn = document.getElementById('addTestReport');
      if (addTestReportBtn) {
        addTestReportBtn.addEventListener('click', function() {
          // Datos de ejemplo para el reporte de prueba
          const testReports = [
            {
              title: "Contenedor de basura desbordado",
              address: "Calle Principal 456",
              reporter: "Carlos M.",
              imageUrl: "../img/1.png"
            },
            {
              title: "Acumulación de escombros",
              address: "Av. Las Flores 789",
              reporter: "Laura G.",
              imageUrl: "../img/2.png"
            },
            {
              title: "Desechos en vía pública",
              address: "Callejón Oscuro 101",
              reporter: "Roberto S.",
              imageUrl: "../img/3.png"
            }
          ];
          
          // Seleccionar un reporte aleatorio
          const randomReport = testReports[Math.floor(Math.random() * testReports.length)];
          
          // Agregar el reporte
          if (window.addNewReport) {
            window.addNewReport(randomReport);
          } else {
            console.error('La función addNewReport no está disponible');
          }
        });
      }
    });
  </script>
</body>
</html>
